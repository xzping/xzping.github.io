---
layout: post
title:  "分布式系统的特征"
date:   2018-05-28
excerpt: "分布式系统的一般特征"
tag:
- 分布式系统
- 特征
comments: true
---

## 分布式系统的特征
分布式系统的特征：可扩展性（Scalability）、高性能（High Performance）、高可用（High Availability）、一致性（Consistency）。

这四个特性也是分布式系统的衡量指标，正式为了在不同程度上满足这些特性（或者说达到这些指标），才会设计会各种各样的算法、协议，然后根据业务的需求在这些特性间平衡。

### 可扩展性（Scalability）
可扩展性是指当系统的任务（work）增加的时候，通过增加资源来应对任务增长的能力。可扩展性是任何分布式系统必备的特性，这是由分布式系统的概念决定的：

> 分布式系统是由一组通过网络进行通信、为了完成共同的任务而协调工作的计算机节点组成的系统。

分布式系统的出现是为了解决单个计算机无法完成的计算、存储任务。那么当任务规模增加的时候，必然就需要添加更多的节点，这就是可扩展性。

扩展性的目标是使得系统中的节点都在一个较为稳定的负载下工作，这就是负载均衡，当然，在动态增加节点的时候，需要进行任务（可能是计算，可能是数据存储）的迁移，以达到动态均衡。

那么首先要考虑的问题就是，如何对任务进行拆分，将任务的子集分配到每一个节点，我们称这个过程问题分片（Partition）。

### 可用性（Availability）
可用性（Availability）是系统不间断对外提供服务的能力，可用性是一个度的问题，最高目标就是7 * 24，即永远在线。但事实上是做不到的，一年之中系统也会有不可用的时间段。

为什么分布式系统中必须要考虑可用性呢？这是因为分布式系统中故障的概率很高。分布式系统由大量异构的节点和网络组成，节点可能会crash、断电、磁盘损坏，网络可能丢包、延迟、网络分割。系统的规模放大了出故障的概率，因此分布式系统中，故障是常态。那么分布式系统的其中一个设计目标就是容错，在部分故障的情况下仍然对外提供服务，这就是可用性。

* 冗余是提高可用性、可靠性的法宝。 *

冗余就是说多个节点负责相同的任务，在需要状态维护的场景，比如分布式存储中使用非常广泛。在分布式计算，如MapReduce中，当一个worker运行异常缓慢时，master会将这个worker上的任务重新调度到其它worker，以提高系统的吞吐，这也算一种冗余。但存储的冗余相比计算而言要复杂许多，因此主要考虑存储的冗余。

维护同一份数据的多个节点称之为多个副本。我们考虑一个问题，当向这个副本集写入数据的时候，怎么保证并发情况下数据的一致性，是否有一个节点有决定更新的顺序，这就是中心化、去中心化副本协议的区别。

> 中心化就是有一个主节点（primary master）负责调度数据的更新，其优点是协议简单，将并发操作转变为顺序操作，缺点是primary可能成为瓶颈，且在primary故障的时候重新选举会有一段时间的不可用。

> 去中心化就是所有节点地位平等，都能够发起数据的更新，优点是高可用，缺点是协议复杂，要保证一致性很难。

冗余机制会带来一致性问题。

### 一致性（Consistency）
从上面可以看到，为了高可用性，引入了冗余（副本）机制，而副本机制就带来了一致性问题。当然，如果没有冗余机制，或者不是数据（状态）的冗余，那么不会出现一致性问题，比如MapReduce。

一致性与可用性在分布式系统中的关系，已经有足够的研究，形成了CAP理论。CAP理论就是说分布式数据存储，最多只能同时满足一致性（C，Consistency）、可用性（A， Availability）、分区容错性（P，Partition Tolerance）中的两者。但一致性和可用性都是一个度的问题，是0到1，而不是只有0和1两个极端。

![CAP Image](http://ox6xu9hb7.bkt.clouddn.com/1089769-20180314103757972-554610630.png)
{: .image-middle}

### 高性能（High Performance）
正是因为单个节点的scale up不能完成任务，因此我们才需要scale out，用大量的节点来完成任务，分布式系统的理想目标是任务与节点按一定的比例线性增长。

高性能的衡量指标：高并发、高吞吐、低延迟。

可行的办法：单个节点的scale up、分片（Partition）、缓存、短事务。
